From 0a7756d4ef2f329fa7caa8e4052a099a91816f2f Mon Sep 17 00:00:00 2001
From: Jerome Soumagne <jerome.soumagne@hpe.com>
Date: Mon, 24 Nov 2025 16:44:14 -0600
Subject: [PATCH 1/3] NA OFI/UCX: print version infos

NA OFI: fix log warning
---
 src/na/na_ofi.c | 12 +++++++-----
 src/na/na_ucx.c | 10 ++++++++++
 2 files changed, 17 insertions(+), 5 deletions(-)

diff --git a/src/na/na_ofi.c b/src/na/na_ofi.c
index c7c3e0b3..682efe65 100644
--- a/src/na/na_ofi.c
+++ b/src/na/na_ofi.c
@@ -8048,8 +8048,10 @@ na_ofi_check_protocol(const char *protocol_name)
     uint32_t runtime_version = fi_version();
     na_return_t na_ret;
 
-    NA_LOG_SUBSYS_DEBUG(cls, "Querying info on libfabric v%d.%d",
-        FI_MAJOR(runtime_version), FI_MINOR(runtime_version));
+    NA_LOG_SUBSYS_INFO(cls,
+        "Querying info on libfabric (runtime v%d.%d, API v%d.%d)",
+        FI_MAJOR(runtime_version), FI_MINOR(runtime_version),
+        FI_MAJOR(FI_COMPILE_VERSION), FI_MINOR(FI_COMPILE_VERSION));
     NA_CHECK_SUBSYS_ERROR(cls, FI_VERSION_LT(runtime_version, NA_OFI_VERSION),
         out, accept, false,
         "runtime libfabric version (v%d.%d) is lower than required version "
@@ -9105,7 +9107,7 @@ na_ofi_mem_handle_create(na_class_t NA_UNUSED *na_class, void *buf,
 
     NA_LOG_SUBSYS_DEBUG(mem,
         "Created mem handle %p (iov_base=%p, iov_len=%zu, iovcnt=1, "
-        "flags=0x%lx, len=%zu)",
+        "flags=0x%" PRIx8 ", len=%" PRIu64 ")",
         (void *) na_ofi_mem_handle, na_ofi_mem_handle->desc.iov.s[0].iov_base,
         na_ofi_mem_handle->desc.iov.s[0].iov_len,
         na_ofi_mem_handle->desc.info.flags, na_ofi_mem_handle->desc.info.len);
@@ -9444,8 +9446,8 @@ na_ofi_mem_handle_deserialize(na_class_t NA_UNUSED *na_class,
         na_ofi_mem_handle->desc.info.iovcnt);
 
     NA_LOG_SUBSYS_DEBUG(mem,
-        "Deserialized mem handle %p (iov_base=%p, iov_len=%zu, iovcnt=%zu, "
-        "flags=0x%lx, len=%zu)",
+        "Deserialized mem handle %p (iov_base=%p, iov_len=%zu, iovcnt=%" PRIu64
+        ", flags=0x%" PRIx8 ", len=%" PRIu64 ")",
         (void *) na_ofi_mem_handle, na_ofi_mem_handle->desc.iov.s[0].iov_base,
         na_ofi_mem_handle->desc.iov.s[0].iov_len,
         na_ofi_mem_handle->desc.info.iovcnt, na_ofi_mem_handle->desc.info.flags,
diff --git a/src/na/na_ucx.c b/src/na/na_ucx.c
index 96501b27..7c0ac8d4 100644
--- a/src/na/na_ucx.c
+++ b/src/na/na_ucx.c
@@ -3433,8 +3433,18 @@ na_ucx_check_protocol(const char *protocol_name)
         .field_mask = UCP_PARAM_FIELD_FEATURES, .features = NA_UCX_FEATURES};
     ucp_context_h context = NULL;
     ucs_status_t status;
+    unsigned int runtime_major_version, runtime_minor_version,
+        runtime_patch_version;
     bool accept = false;
 
+    ucp_get_version(
+        &runtime_major_version, &runtime_minor_version, &runtime_patch_version);
+
+    NA_LOG_SUBSYS_INFO(cls,
+        "Querying info on UCX (runtime v%u.%u.%u, API v%u.%u)",
+        runtime_major_version, runtime_minor_version, runtime_patch_version,
+        UCP_API_MAJOR, UCP_API_MINOR);
+
     status = ucp_config_read(NULL, NULL, &config);
     NA_CHECK_SUBSYS_ERROR_NORET(cls, status != UCS_OK, done,
         "ucp_config_read() failed (%s)", ucs_status_string(status));
-- 
2.52.0

