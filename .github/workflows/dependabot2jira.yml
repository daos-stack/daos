# .github/workflows/dependabot2jira.yml
name: Dependabo jira ticket

permissions: {}

on:
  push:
  pull_request:
    types: [opened]

jobs:
  run-if-grom72:
    if: github.actor == 'grom72'
    runs-on: ubuntu-latest
    steps:
      - name: Send request to Jira
        run: |
          curl -u "${{ secrets.JIRA_USERNAME }}:${{ secrets.JIRA_PASSWORD }}" \
            --verbose \
            -X POST \
            -H "Content-Type: application/json" \
            --data "$(jq -n --arg title "${{ github.event.pull_request.title }}" \
                           --arg body "$( cat << EOF \
                           ${{ github.event.pull_request.body }} \
                           EOF \
                           )" \
                           '{ \
                              fields: { \
                                project: { key: "PMDK" }, \
                                summary: $title, \
                                description: $body, \
                                issuetype: { name: "Bug" } \
                              } \
                            }')" "https://daosio.atlassian.net/rest/api/2/issue"
