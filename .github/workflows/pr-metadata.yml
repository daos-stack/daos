name: Jira Report

on:
  # This should probably be pull_request_target.
  pull_request:

jobs:
  example_comment_pr:
    runs-on: ubuntu-latest
    name: Report Jira data to PR comment
    env:
      PR_TITLE: ${{ github.event.pull_request.title }}
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: install jira
        run: python3 -m pip install jira
      - name: Load jira metadata
        run: ./ci/jira_query.py
        id: jira-data
      - name: Comment on PR
        if: always()
        uses: thollander/actions-comment-pull-request@v1
        with:
          comment_includes: 'Bug-tracker data'
          message: |
            Bug-tracker data:
            ${{ steps.jira-data.outputs.summary }}
            Jira ticket status is ${{ steps.jira-data.outputs.status }}
            Labels: ${{ steps.jira-data.outputs.labels }}
            Build should proceed at ${{ steps.jira-data.outputs.priority }} priority
            ${{ steps.jira-data.outputs.errors }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
