"""Build dfio plugin"""
import os

def scons():
    """Execute build"""

    Import('env')

    dfio_libs = ['daos_common', 'daos', 'dfs', 'gurt', 'uuid', 'dl']

    denv = env.Clone()

    if denv.subst("$FIO_SRC") != "":
        FIO_DIR = denv.subst("$FIO_SRC")
    else:
        FIO_DIR = Dir('#/_build.external/fio').abspath

    if os.path.isdir(FIO_DIR):
        denv.AppendUnique(CPPPATH = [FIO_DIR])

        daos_fio = denv.Program('daos_fio', ['daos_fio.c'], LIBS=dfio_libs)
        env.Install('$PREFIX/bin/', daos_fio)

        daos_fio_async = denv.Program('daos_fio_async', ['daos_fio_async.c'],
                                      LIBS=dfio_libs)
        env.Install('$PREFIX/bin/', daos_fio_async)

if __name__ == "SCons.Script":
    scons()
